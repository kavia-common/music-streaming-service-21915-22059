{"is_source_file": true, "format": "Python", "description": "This file implements a FastAPI-based REST API for a monitoring and logging service, including endpoints for ingesting logs and metrics, querying logs and metrics, managing alerts, and health checking. It contains middleware configuration, environment variable loading, data persistence mechanisms, and data models for logs, metrics, and alert rules.", "external_files": ["fastapi", "pydantic", "starlette.middleware.cors", "typing", "datetime", "os", "json", "threading"], "external_methods": ["fastapi.Depends", "fastapi.FastAPI", "fastapi.Header", "fastapi.HTTPException", "fastapi.Query", "fastapi.status", "fastapi.middleware.cors.CORSMiddleware", "pydantic.BaseModel", "pydantic.Field", "datetime.datetime", "os.getenv", "os.makedirs", "os.path.join", "os.path.exists", "os.replace", "json.load", "json.dump"], "published": ["health_check", "ingest_logs", "ingest_metrics", "query_logs", "query_metrics", "get_alerts", "upsert_alert"], "classes": [{"name": "LogIngest", "description": "Data model for log ingestion payload, including source, timestamp, level, message and optional metadata."}, {"name": "MetricIngest", "description": "Data model for metric ingestion payload, including source, timestamp, and metrics dictionary."}, {"name": "AlertRule", "description": "Data model representing an alert rule with name, expression, severity, and notification channels."}], "methods": [{"name": "_load_api_keys_from_env", "description": "Loads API keys from environment variable 'OBS_API_KEYS' and returns as a dictionary."}, {"name": "_load_json_file", "description": "Loads JSON data from a file, returning default if file doesn't exist or on error."}, {"name": "_save_json_file", "description": "Saves data to a JSON file asynchronously, with temporary file safety."}, {"name": "_bootstrap_store", "description": "Initializes in-memory logs, metrics, and alerts from persisted JSON files at startup."}, {"name": "_persist_async", "description": "Triggers asynchronous persistence of current in-memory logs, metrics and alerts to disk."}], "calls": ["os.getenv", "os.makedirs", "os.path.join", "os.path.exists", "json.load", "json.dump", "os.replace", "threading.Thread", "datetime.fromisoformat"], "search-terms": ["MonitoringLogging", "api/main.py", "Ingest logs", "Ingest metrics", "Query logs", "Query metrics", "Alert management", "FastAPI setup", "Observability API"], "state": 2, "file_id": 5, "knowledge_revision": 22, "git_revision": "25552160c8b1c53c63ddddab92465016509d17e1", "revision_history": [{"11": ""}, {"14": "ee642739d8e52ebede6bade82cd99b775234de49"}, {"17": "25552160c8b1c53c63ddddab92465016509d17e1"}, {"22": "25552160c8b1c53c63ddddab92465016509d17e1"}], "ctags": [], "hash": "3d10fface700b0caa5c63c3099a2b35c", "format-version": 4, "code-base-name": "Monitoring&Logging", "filename": "Monitoring&Logging/music-streaming-service-21915-22059/MonitoringLogging/src/api/main.py"}